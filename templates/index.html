{% load static %}
{% load translation_filter %}

<!DOCTYPE html>
<html lang="{{ lang_code }}">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>{{ "page_title"|translate:lang_code }}</title>
  <link rel="stylesheet" href="{% static 'css/style.css' %}" />
</head>
<body>

    <header class="main-header">
      <div class="header-overlay">
        <div class="lang-container">
          {% for lan in languages %}
            <a href="/{{ lan.code }}/" class="lang-link {% if lang_code == lan.code %}active{% endif %}">
              {{ lan.title }}
            </a>
          {% endfor %}
        </div>
      </div>
    </header>

  <main>
    <div class="form-container">
      <div class="form-header">
        <h3>{{ "form_title"|translate:lang_code }}</h3>
        <p>{{ "form_subtitle"|translate:lang_code }}</p>
      </div>

      <form method="POST" enctype="multipart/form-data">
        {% csrf_token %}

        <div class="row">
          <div class="col">
            <label>{{ "name_label"|translate:lang_code }} *</label>
            <input type="text" name="name" required />
          </div>
          <div class="col">
            <label>{{ "surname_label"|translate:lang_code }} *</label>
            <input type="text" name="surname" required />
          </div>
        </div>

        <div class="row">
          <div class="col">
            <label>{{ "age_label"|translate:lang_code }} *</label>
            <input type="number" name="age" required />
          </div>
          <div class="col">
            <label>{{ "iin_label"|translate:lang_code }} *</label>
            <input type="text" name="iin" required />
          </div>
        </div>

        <div class="row">
          <div class="col">
            <label>{{ "phone_label"|translate:lang_code }} *</label>
            <input type="tel" name="phone_number" placeholder="+7 777 777 77 77" required />
          </div>
          <div class="col">
            <label>{{ "children_label"|translate:lang_code }} *</label>
            <input type="number" name="child_in_fam" required />
          </div>
        </div>

        <div class="row">
          <div class="col full">
            <label>{{ "status_label"|translate:lang_code }} *</label>
            <select name="material_status" required>
              <option value="">{{ "choose_status"|translate:lang_code }}</option>
              {% for status in statuses %}
                <option value="{{ status.id }}">{{ status.title }}</option>
              {% endfor %}
            </select>
          </div>
        </div>

        <div class="row">
          <div class="col full">
            <label>{{ "help_category_label"|translate:lang_code }} *</label>
            <select name="help_category" id="helpCategory" required onchange="toggleOtherCategory(this)">
              <option value="">{{ "choose_category"|translate:lang_code }}</option>
              {% for category in categories %}
                <option value="{{ category.id }}" data-is-other="{{ category.is_other|yesno:'true,false' }}">
                  {{ category.title }}
                </option>
              {% endfor %}
            </select>
          </div>
        </div>

        <div class="row" id="otherCategoryRow" style="display:none;">
          <div class="col full">
            <label>{{ "other_category_label"|translate:lang_code }}</label>
            <input type="text" name="other_category" placeholder="{{ 'enter_other_category'|translate:lang_code }}" />
          </div>
        </div>

        <div class="row">
          <div class="col full">
            <label>üì∑ {{ "file_upload_label"|translate:lang_code }} *</label>
            <p class="upload-desc">{{ "file_upload_desc"|translate:lang_code }}</p>

            <div class="upload-box" onclick="document.getElementById('file').click()">
              <input type="file" id="file" name="file" accept="image/*,.pdf" required hidden onchange="showFileName()" />
              <div class="upload-icon">‚¨ÜÔ∏è</div>
              <p class="upload-text" id="uploadText">{{ "file_upload_btn"|translate:lang_code }}</p>
            </div>
          </div>
        </div>

        <div class="row">
          <div class="col full">
            <label>{{ "address_label"|translate:lang_code }} *</label>
            <input type="text" name="address" required />
          </div>
        </div>

        <div class="row">
          <div class="col full">
            <label>{{ "reason_label"|translate:lang_code }} *</label>
            <textarea name="why_need_help" required></textarea>
          </div>
        </div>

        <button type="submit" class="submit-btn">{{ "submit_button"|translate:lang_code }}</button>
      </form>
    </div>
  </main>

  <footer>
    <p>¬© 2025 {{ "footer_text"|translate:lang_code }}</p>
  </footer>

  <script>
    function changeLang(lang) {
      window.location.href = "/" + lang + "/";
    }
    function showFileName() {
        const input = document.getElementById('file');
        const text = document.getElementById('uploadText');
        if (input.files.length > 0) {
          text.textContent = input.files[0].name;
          text.style.color = "#222";
        } else {
          text.textContent = "{{ 'file_upload_btn'|translate:lang_code }}";
          text.style.color = "#666";
        }
    }
    function toggleOtherCategory(select) {
      const selectedOption = select.options[select.selectedIndex];
      const isOther = selectedOption.getAttribute('data-is-other') === 'true';
      const otherRow = document.getElementById('otherCategoryRow');
      otherRow.style.display = isOther ? 'block' : 'none';
    }
    function showFileName() {
      const fileInput = document.getElementById('file');
      const uploadText = document.getElementById('uploadText');
      if (fileInput.files.length > 0) {
        let fileName = fileInput.files[0].name;
        if (fileName.length > 40) fileName = fileName.slice(0, 37) + "..."; // qisqartirish
        uploadText.textContent = fileName;
      } else {
        uploadText.textContent = "Fayl tanlash";
      }
    }
  </script>
</body>
</html>